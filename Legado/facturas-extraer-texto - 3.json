{
  "model": "gpt-5.1",
  "store": false,
  "instructions": "Eres un asistente experto en facturas. A partir del archivo proporcionado, extrae los datos generales de la factura y las líneas de detalle. Devuelve únicamente un JSON válido que cumpla exactamente el esquema definido.",
  "input": [
    {
      "role": "user",
      "content": [
        {
          "type": "input_text",
          "text": "El archivo accesible en la URL es una factura. Extrae los datos generales de la factura y las líneas que la componen."
        },
        {
          "type": "input_file",
          "file_url": "{{ARCHIVO_URL}}"
        }
      ]
    }
  ],
  "text": {
"format": {
  "type": "json_schema",
  "name": "factura",
  "schema": {
          "type": "object",
          "properties": {
            "datos_generales": {
              "type": "object",
              "properties": {
                "nombre_proveedor": { "type": "string" },
                "nif_proveedor": { "type": "string" },
                "numero_factura": { "type": "string" },
                "fecha_emision": { "type": "string" },
                "moneda": { "type": "string" },
                "importe_base_total": { "type": "number" },
                "importe_impuestos_total": { "type": "number" },
                "importe_retencion_total": { "type": "number" },
                "importe_total": { "type": "number" },
                "observaciones": { "type": "string" }
              },
              "required": [
                "nombre_proveedor",
                "nif_proveedor",
                "numero_factura",
                "fecha_emision",
                "moneda",
                "importe_base_total",
                "importe_impuestos_total",
                "importe_retencion_total",
                "importe_total",
                "observaciones"
              ],
              "additionalProperties": false
            },
            "lineas": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "descripcion": { "type": "string" },
                  "codigo_producto": { "type": "string" },
                  "cantidad": { "type": "number" },
                  "precio_unitario": { "type": "number" },
                  "porcentaje_iva": { "type": "number" },
                  "importe_base": { "type": "number" },
                  "importe_impuesto": { "type": "number" },
                  "importe_total_linea": { "type": "number" }
                },
                "required": [
                  "descripcion",
                  "codigo_producto",
                  "cantidad",
                  "precio_unitario",
                  "porcentaje_iva",
                  "importe_base",
                  "importe_impuesto",
                  "importe_total_linea"
                ],
                "additionalProperties": false
              }
            }
          },
          "required": ["datos_generales", "lineas"],
          "additionalProperties": false
        }
      }
    }
  }